/*********************************************************************************************************************
 * TC264 Opensourec Library 即（TC264 开源库）是一个基于官方 SDK 接口的第三方开源库
 * Copyright (c) 2022 SEEKFREE 逐飞科技
 *
 * 文件名称          delayed_stop.h - 延迟停车功能库
 * 功能说明          提供延迟停车功能，在指定时间后自动禁用PID控制并停止电机
 * 开发环境          ADS v1.9.4
 * 适用平台          TC264D
 ********************************************************************************************************************/

#ifndef DELAYED_STOP_H
#define DELAYED_STOP_H

#include "zf_common_headfile.h"

// *************************** 延迟停车功能说明 ***************************
// 功能：在指定时间后自动禁用PID控制并停止所有电机
// 特性：
// 1. 只有在enable=true时才会计时，enable=false时计时暂停
// 2. 到期时会禁用PID控制(enable=false)并停止所有电机
// 3. 到期时会触发蜂鸣器响1秒提示
// 4. 可随时取消延迟停车任务
// 5. 延迟时间精度为1ms（取决于delayed_stop_update()的调用周期）

// *************************** 全局变量声明 ***************************
extern uint32 delayed_stop_time_ms; // 延迟停车时间(毫秒)，可在菜单中调整
extern uint32 delayed_stop_enabled; // 延迟停车启用开关 (0=禁用, 1=启用)

// *************************** 函数声明 ***************************

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     启动延迟停车
// 参数说明     delay_ms: 延迟时间(毫秒)
// 返回参数     void
// 使用示例     delayed_stop_start(5000); // 5秒后停车
// 备注信息     启动延迟停车计时器，到期后自动禁用PID控制、停止所有电机并响蜂鸣器
//              如果delay_ms为0，则立即停车
//              只有在enable=true时才会计时
//-------------------------------------------------------------------------------------------------------------------
void delayed_stop_start(uint32 delay_ms);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     启动延迟停车（使用全局参数delayed_stop_time_ms）
// 参数说明     void
// 返回参数     void
// 使用示例     delayed_stop_start_with_param(); // 使用菜单中设置的时间
// 备注信息     使用全局变量delayed_stop_time_ms作为延迟时间
//              方便在菜单功能中直接调用
//-------------------------------------------------------------------------------------------------------------------
void delayed_stop_start_with_param(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     取消延迟停车
// 参数说明     void
// 返回参数     void
// 使用示例     delayed_stop_cancel(); // 取消延迟停车
// 备注信息     取消延迟停车任务，不影响当前电机运行状态
//-------------------------------------------------------------------------------------------------------------------
void delayed_stop_cancel(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     延迟停车更新函数（需要在control()函数中调用）
// 参数说明     void
// 返回参数     void
// 使用示例     delayed_stop_update(); // 在control()函数中调用
// 备注信息     更新延迟停车计时器，到期后自动停车
//              必须在enable=true时才调用，否则不会计时
//-------------------------------------------------------------------------------------------------------------------
void delayed_stop_update(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     查询是否有延迟停车任务在运行
// 参数说明     void
// 返回参数     bool: true=有延迟停车任务在运行, false=无
// 使用示例     if(delayed_stop_is_active()) { ... }
// 备注信息
//-------------------------------------------------------------------------------------------------------------------
bool delayed_stop_is_active(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     获取剩余停车时间
// 参数说明     void
// 返回参数     uint32: 剩余停车时间(毫秒)，如果未激活返回0
// 使用示例     uint32 remaining = delayed_stop_get_remaining_time();
// 备注信息
//-------------------------------------------------------------------------------------------------------------------
uint32 delayed_stop_get_remaining_time(void);

#endif
